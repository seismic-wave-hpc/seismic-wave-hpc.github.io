---
title: アカウント継続者の初期設定
date: 2025-03-02
abstract: "EICでは以前からのユーザー向けにこれまでの接続情報やアカウントの設定が維持されています．一方，今回はシステム更新による大きな変更があったため，従来ユーザーは特別な作業が必要になる場合もあります．"
---

これまでのEIC計算機システムにおいても，アカウントの保持者のデータはそのまま移行されてきました．しかし，2025年3月における更新では，以下の2点の大きな変更があったため，注意が必要です．

- ユーザー名 `j0XXXX` への変更
  - これまで希望する文字列による任意のユーザー名であったものが，番号によるユーザー名に変更されました．
- `/work` ディレクトリの廃止
  - 従来は一定期間のみ大容量データを配置できる `/work/(ユーザー名)` ディレクトリがありましたが，廃止されました．そこに置かれていたデータはアカウント移行時に全削除されています．

## 接続設定

### 秘密鍵と公開鍵

[公式マニュアル](https://eic-support.eri.u-tokyo.ac.jp/wiki/?ログイン方法)には公開鍵をWebから登録するように記述がありますが，これまでにEICを利用していたユーザーが登録していた公開鍵はそのまま保持されているようですので，**EICへの接続のための公開鍵・秘密鍵の再作成は原則として不要**です．ただし，システム更新でユーザー名が変更された方は以下の注意と，場合によっては設定ファイルの編集が必要です．

#### `config` ファイルの設定変更

::: {.callout-important}
本項目はEIC2025で**ユーザー名が変更になった人**のみが対象です．従前からのEICユーザーでも，比較的最近にアカウントを開設された方はユーザー名が変わっていない（`j0XXXX`）ようで，その場合は本項目の対応は必要ありません．
:::

たとえばEICへの接続にあたり[自動二段階接続](../Archives/EIC2020/EIC2020-0A-two-step-connection.md)を行うなど，`~/.ssh/config` ファイルに接続の設定が記述されている人は，そこに以下のような記述があるはずです．

```
Host eic
     Hostname eic.eri.u-tokyo.ac.jp
     User USERNAME-of-EIC
     ProxyCommand ssh -W %h:%p bdec
     IdentityFile ~/.ssh/id_rsa
     ForwardX11 yes
```

このうち，3行目の`User` の欄を，新しいユーザー名に変更する必要があります．

`ProxyCommand` を使わずに`config`ファイルを利用していた場合（VSCode経由での接続など）でも同様です．

### `known_hosts` ファイルの編集

sshコマンドで新たなEICに接続しようとすると，

```ssh
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
```

からはじまるエラーメッセージが表示され，接続が強制的に打ち切られる場合があります．

これは，接続先ホスト（`eic.eri.u-tokyo.ac.jp`）の公開鍵が変わってしまったためです．接続先の情報は接続元の `~/.ssh/known_hosts` ファイルに自動的に保存されており，接続時にそこの記録と接続先の公開鍵との突合が行われます．これはセキュリティのための仕組みですが，今回は単に接続先のシステム更新による変更であるとわかっていますので，手動で対処します．

対処法は以下の3種類で，同じ効果を持ちますが上ほど推奨する方法です．

#### `ssh-keygen` コマンドによる方法

接続元ホストで `ssh-keygen -R eic.eri.u-tokyo.ac.jp` を実行するだけです．`known_hosts`ファイルから該当するレコードを自動で探し出し，削除してくれます．

```bash
$ ssh-keygen -R eic.eri.u-tokyo.ac.jp
# Host eic.eri.u-tokyo.ac.jp found: line XX
# Host eic.eri.u-tokyo.ac.jp found: line XX
# Host eic.eri.u-tokyo.ac.jp found: line XX
/path/to/home/.ssh/known_hosts updated.
Original contents retained as /path/to/home/.ssh/known_hosts.old
```

実行すると上記のように表示されます．表示のとおり，削除された情報を含む `known_hosts` ファイルはバックアップされます．不要でしたら削除しても構いません．

#### `known_hosts` ファイルから該当レコードの手動削除

`~/.ssh/known_hosts` ファイルはただのテキストファイルですから，エディタでファイルを開き，`eic.eri.u-tokyo.ac.jp` の含まれる行を削除しても大丈夫です．対処法1とほとんど同じ結果になりますが，自動バックアップはなされません．

#### `known_hosts` ファイルの削除

やや（かなり？）乱暴ですが，`~/.ssh/known_hosts` ファイルそのものを強制的に削除してしまっても構いません．その場合，`ssh`でこれまで利用していたサーバに接続しようとするたび，本当に接続するかどうかを1回ずつ答えることになります．

## Miniforgeの再構築

::: {.callout-important}
本項目はEIC2025で**ユーザー名が変更になった人**のみが対象です．従前からのEICユーザーでも，比較的最近にアカウントを開設された方はユーザー名が変わっていない（`j0XXXX`）ようで，その場合は本項目の対応は必要ありません．
:::

ユーザー名が変わってしまったため，[従来の方法](../Archives/EIC2020/EIC2020-03-environment.md)でMiniforgeによる環境を構築していた人は，インストールのやりなおしが必要です．

### 旧環境の削除

まず，インストール先ディレクトリを削除します．通常は `~/miniforge3` のはずです．

```bash
rm -rf miniforge3
```

非常に多くのファイルが含まれるため，削除には数分の時間がかかることもあります．

`.bashrc` ファイル設定の削除

```bash
# >>> conda initialize >>>
```

から

```bash
# <<< conda initialize <<<
```

までの設定を削除します．
